<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Dashboard Click Fix</title>

    <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

    <script>
        // 1. SLIDESHOW
        AFRAME.registerComponent('slideshow', {
            init: function() {
                const el = this.el;
                const images = [
                    "https://placehold.co/400x300/orange/white?text=Slide+1", 
                    "https://placehold.co/400x300/purple/white?text=Slide+2", 
                    "https://placehold.co/400x300/green/white?text=Slide+3"
                ];
                let index = 0;
                setInterval(() => {
                    index = (index + 1) % images.length;
                    el.setAttribute('src', images[index]);
                }, 2000); 
            }
        });

        // 2. SUPER CLICKER (Handles Touch AND Click)
        AFRAME.registerComponent('social-link', {
            schema: { url: {type: 'string'} },
            init: function() {
                // Function to handle opening the link
                const openLink = () => {
                    // Visual feedback: briefly turn red
                    this.el.setAttribute('color', 'red'); 
                    setTimeout(() => this.el.setAttribute('color', 'white'), 200);
                    
                    alert("Opening: " + this.data.url);
                    // window.open(this.data.url, '_blank'); 
                };

                // Listen for BOTH Mouse Click and Finger Touch
                this.el.addEventListener('click', openLink);
                this.el.addEventListener('touchstart', (e) => {
                    e.preventDefault(); // Prevent double-firing
                    openLink();
                });
            }
        });

        // 3. MARKER HANDLER (Fixes the "Blocked Screen" issue)
        AFRAME.registerComponent('markerhandler', {
            init: function () {
                const loader = document.getElementById('loader');
                this.el.addEventListener('markerFound', () => {
                    console.log("✅ Marker Found");
                    // Send loader to the back so it can't block clicks
                    loader.style.zIndex = "-1"; 
                    loader.style.opacity = "0";
                });
                this.el.addEventListener('markerLost', () => {
                    console.log("❌ Marker Lost");
                });
            }
        });
    </script>
</head>

<body style="margin: 0; overflow: hidden;">

    <div id="loader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.5s;">
        <div>Loading Dashboard...</div>
        <div style="font-size: 12px; margin-top: 10px;">Point camera at image</div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false;"
        renderer="logarithmicDepthBuffer: true;"
        embedded
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
        cursor="rayOrigin: mouse; fuse: false" 
        raycaster="objects: .clickable">

        <a-nft
            markerhandler
            type="nft"
            url="https://Kav1nduAkalanka.github.io/AR_website/assests/nft"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01"
            smoothThreshold="5">

            <a-box 
                color="blue"
                position="-100 0 -150"
                scale="50 50 50"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 4000">
            </a-box>

            <a-image
                slideshow
                src="https://placehold.co/400x300/orange/white?text=Loading..."
                width="150" height="100"
                position="150 0 -150"
                rotation="-90 0 0">
            </a-image>

            <a-entity position="-120 1 0" rotation="-90 0 0">
                <a-plane 
                    class="clickable"
                    social-link="url: Facebook"
                    color="white" opacity="0.9"
                    src="https://placehold.co/100x100/3b5998/white?text=FB"
                    width="60" height="60"> </a-plane>
            </a-entity>

            <a-entity position="-40 1 0" rotation="-90 0 0">
                <a-plane 
                    class="clickable"
                    social-link="url: LinkedIn"
                    color="white" opacity="0.9"
                    src="https://placehold.co/100x100/0077b5/white?text=LI"
                    width="60" height="60">
                </a-plane>
            </a-entity>

            <a-entity position="40 1 0" rotation="-90 0 0">
                <a-plane 
                    class="clickable"
                    social-link="url: GitHub"
                    color="white" opacity="0.9"
                    src="https://placehold.co/100x100/333/white?text=GH"
                    width="60" height="60">
                </a-plane>
            </a-entity>

            <a-entity position="120 1 0" rotation="-90 0 0">
                <a-plane 
                    class="clickable"
                    social-link="url: Website"
                    color="white" opacity="0.9"
                    src="https://placehold.co/100x100/e91e63/white?text=WEB"
                    width="60" height="60">
                </a-plane>
            </a-entity>

        </a-nft>

        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>