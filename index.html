<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Dashboard Stable</title>

    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

    <style>
        /* CHANGE 2: Ensure loader allows clicks to pass through */
        #loader {
            pointer-events: none; 
        }
    </style>

    <script>
        // Slideshow Logic
        AFRAME.registerComponent('slideshow', {
            init: function() {
                const el = this.el;
                const images = [
                    "https://placehold.co/400x300/orange/white?text=Slide+1", 
                    "https://placehold.co/400x300/purple/white?text=Slide+2", 
                    "https://placehold.co/400x300/green/white?text=Slide+3"
                ];
                let index = 0;
                setInterval(() => {
                    index = (index + 1) % images.length;
                    el.setAttribute('src', images[index]);
                }, 2000); 
            }
        });

        // Click Logic
        AFRAME.registerComponent('social-link', {
            schema: { url: {type: 'string'} },
            init: function() {
                this.el.addEventListener('click', () => {
                    // Visual feedback: flash red
                    this.el.setAttribute('material', 'color', 'red'); 
                    setTimeout(() => {
                        this.el.setAttribute('material', 'color', 'white');
                    }, 200);

                    // Open link
                    alert("Opening: " + this.data.url);
                    // window.open(this.data.url, '_blank'); 
                });
            }
        });

        // Marker Handler
        AFRAME.registerComponent('markerhandler', {
            init: function () {
                const loader = document.getElementById('loader');
                this.el.addEventListener('markerFound', () => {
                    loader.style.opacity = "0";
                });
                this.el.addEventListener('markerLost', () => {
                    // Optional: Show loader again if marker is lost
                    // loader.style.opacity = "1";
                });
            }
        });
    </script>
</head>

<body style="margin: 0; overflow: hidden;">

    <div id="loader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.5s;">
        <div>Loading...</div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false;"
        renderer="logarithmicDepthBuffer: true;"
        embedded
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
        cursor="rayOrigin: mouse"
        raycaster="objects: .clickable">

        <a-nft
            markerhandler
            type="nft"
            url="https://Kav1nduAkalanka.github.io/AR_website/assests/nft"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01"
            smoothThreshold="5">

            <a-box 
                color="blue"
                position="-100 0 -150"
                scale="50 50 50"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 4000">
            </a-box>

            <a-image
                slideshow
                src="https://placehold.co/400x300/orange/white?text=Loading..."
                width="150" height="100"
                position="150 0 -150"
                rotation="-90 0 0">
            </a-image>

            <a-entity position="-120 1 0" rotation="-90 0 0">
                <a-plane class="clickable" social-link="url: Facebook" color="white" opacity="0.9" src="https://placehold.co/100x100/3b5998/white?text=FB" width="80" height="80"></a-plane>
            </a-entity>

            <a-entity position="-40 1 0" rotation="-90 0 0">
                <a-plane class="clickable" social-link="url: LinkedIn" color="white" opacity="0.9" src="https://placehold.co/100x100/0077b5/white?text=LI" width="80" height="80"></a-plane>
            </a-entity>

            <a-entity position="40 1 0" rotation="-90 0 0">
                <a-plane class="clickable" social-link="url: GitHub" color="white" opacity="0.9" src="https://placehold.co/100x100/333/white?text=GH" width="80" height="80"></a-plane>
            </a-entity>

            <a-entity position="120 1 0" rotation="-90 0 0">
                <a-plane class="clickable" social-link="url: Website" color="white" opacity="0.9" src="https://placehold.co/100x100/e91e63/white?text=WEB" width="80" height="80"></a-plane>
            </a-entity>

        </a-nft>

        <a-entity camera></a-entity>

    </a-scene>
</body>
</html>